/**!
 * FooNav - A jQuery navigation menu.
 * @version 0.0.6
 * @link http://fooplugins.github.io/foonav/
 * @copyright Steven Usher & Brad Vincent 2014
 * @license Released under the MIT license.
 */
!function(a,b){b.FooNav={defaults:{after:null,before:null,buttons:null,classes:null,deeplinking:!1,icons:{back:{family:"fon-icon",icon:"fon-icon-back"},expand:{family:"fon-icon",icon:"fon-icon-expand"},home:{family:"fon-icon",icon:"fon-icon-home"},menu:{family:"fon-icon",icon:"fon-icon-menu"},top:{family:"fon-icon",icon:"fon-icon-top"}},items:"body",position:"fon-top-right",theme:"fon-light",title:null,top:!0,transition:"slide",scroll:0,speed:200,smart:{enable:!0,anchors:!0,close:!0,open:!1,remember:!0,scroll:!0,url:!0},anchorDistance:0},instances:[]},jQuery.Event.prototype.allow=!1,FooNav.fetch=function(a){return a=a>FooNav.instances.length-1?FooNav.instances.length-1:a<0?0:a,FooNav.instances[a]},FooNav.init=function(a){return new FooNav.Instance(a)},FooNav.reinit=function(a,b){FooNav.fetch(a).reinit(b)},FooNav.destroy=function(a){FooNav.fetch(a).destroy()},FooNav.destroyAll=function(){for(var a=0;a<FooNav.instances.length;a++){var b=FooNav.instances[a];null!=b&&b.destroy()}},FooNav.items=function(b,c,d){function e(b){for(var c=0;c<k.length;c++)if(a(b).is(k[c]))return c;return-1}function f(a){for(var b=[],c=0;c<a;c++)b.push(k[c]);return b.join(",")}function g(a,b){for(var c=0;c<b.length;c++){if(b[c].href=="#"+a)return b[c];if(b[c].children){var d=g(a,b[c].children);if(null!=d)return d}}return null}function h(b,c){return null==d||""==d||0==a(c).closest(d).length}function i(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}b=b||"body",c=c||"h1,h2,h3,h4,h5,h6",d=d||"";var j=[],k=c.split(","),l=null,m=null,n=null,o=null,p=null;return a(b).find(c).filter(h).each(function(){if(m=this,p=a(m),""!=m.id&&null!=m.id||(m.id=i()),l={text:p.text(),href:"#"+m.id},o=f(e(m)),null!=o&&""!=o)if(n=p.prevAll(o).first(),n.length>0){var b=g(n.attr("id"),j);null!=b?(b.children=b.children||[],b.children.push(l)):j.push(l)}else j.push(l);else j.push(l)}),j},FooNav.Timer=function(){this.id=null;var a=this;return this.start=function(b,c){a.stop(),a.id=setTimeout(function(){a.id=null,b()},c)},this.stop=function(){null!=a.id&&(clearTimeout(a.id),a.id=null)},this},FooNav.Instance=function(c){this.id=FooNav.instances.push(this),this.index=this.id-1,this.o=a.extend(!0,{},FooNav.defaults),this.nav=null,this.inner=null,this.buttons=null,this.back=null,this.top=null,this.toggle_button=null,this.menu=null,this.initialized=!1;var d=this,e={},f=function(){};return e.ready=null,this.init=function(c){return d.o=a.extend(!0,d.o,c),d.b.items(),d.b.nav(),d.b.buttons(),d.b.menu(),d.b.extra(),d.o.smart.enable&&(d.o.smart.url&&d.m.set(location.href,d.o.smart.open),d.o.smart.close&&a(b).on("click",d.w.clicked),d.o.smart.anchors&&a(b).on("scroll",d.a.check)),a(b).on("scroll",d.w.scrolled).on("resize",d.w.resized),0==d.o.scroll&&d.nav.show(),setTimeout(function(){d.m.position(!1),d.initialized=!0,a.isFunction(e.ready)&&e.ready.call(d,d)},500),d},this.reinit=function(a){d.destroy(!0),d.init(a)},this.destroy=function(c){d.initialized=!1,c=c||!1,a(b).off("scroll",d.a.check).off("scroll",d.w.scrolled).off("click",d.w.clicked).off("resize",d.w.resized),d.nav.remove(),d.o=a.extend(!0,{},FooNav.defaults),d.nav=d.inner=d.back=d.top=d.toggle_button=d.menu=null,c||(FooNav.instances[d.index]=null)},this.ready=function(b){a.isFunction(b)&&(1==d.initialized?b.call(d,d):e.ready=b)},this.toggle=function(){d.m.toggle({allow:!0})},this.u={_a:document.createElement("a"),qualify:function(a){return d.u._a.href=a,d.u._a.href},isCurrent:function(a){return d.u.qualify(a)==[location.protocol,"//",location.host,location.pathname].join("")},concat:function(a,b,c){return Array.prototype.slice.call(arguments).join(" ")},position:function(){var a=d.o.position.split("-");return{v:a[1],h:a[2]}},exists:function(b,c,d){if(c=c||f,d=d||f,"string"==typeof b&&"#"==b.substring(0,1)){var e=a(b);return e.length>0?(c(e),!0):(d(),!1)}return d(),!1},viewportSize:function(){var a="undefined"!=typeof b.devicePixelRatio?b.devicePixelRatio:1;return{width:(b.innerWidth||document.documentElement.clientWidth||(document.body?document.body.offsetWidth:0))/a,height:(b.innerHeight||document.documentElement.clientHeight||(document.body?document.body.offsetHeight:0))/a}},_supportsTransitions:null,supportsTransitions:function(){if(null!=d.u._supportsTransitions)return d.u._supportsTransitions;var a,b=document.body||document.documentElement,c=b.style,e="transition";if("string"==typeof c[e])return!0;a=["Moz","Webkit","Khtml","O","ms"],e=e.charAt(0).toUpperCase()+e.substr(1);for(var f=0;f<a.length;f++)if("string"==typeof c[a[f]+e])return d.u._supportsTransitions=!0;return d.u._supportsTransitions=!1}},this.b={items:function(){if(!a.isArray(d.o.items)){var b=typeof d.o.items;"string"==b?d.o.items=FooNav.items(d.o.items):"object"==b&&(d.o.items=FooNav.items(d.o.items.container,d.o.items.selector,d.o.items.exclude))}},nav:function(){d.nav=a("<div></div>",{"class":d.u.concat("fon-nav",d.o.position,d.o.theme,d.o.classes),css:{display:"none"}}).on("click",".fon-item-link",d.m.clicked).on("click",".fon-item-back",d.m.back).appendTo("body")},buttons:function(){function b(b){var c=d.o.icons[b];return c?a("<span></span>",{"class":d.u.concat("fon-button-icon",c.family,c.icon)}):a()}if(d.buttons=a("<div></div>",{"class":"fon-buttons"}).appendTo(d.nav),d.top=a("<a></a>",{"class":"fon-button fon-button-top",href:"#top",on:{click:d.w.top}}).append(b("top")).appendTo(d.buttons),d.toggle_button=a("<a></a>",{"class":"fon-button",href:"#toggle",on:{click:d.m.toggle}}).append(b("menu")).appendTo(d.buttons),"object"==typeof d.o.buttons)for(var c in d.o.buttons)if(d.o.buttons.hasOwnProperty(c)&&d.o.icons.hasOwnProperty(c)){var e=d.o.buttons[c];if("string"==typeof e){if("home"==c&&d.u.isCurrent(e))continue;a("<a></a>",{"class":"fon-button",href:e}).append(b(c)).appendTo(d.buttons)}else if("object"==typeof e){if("string"!=typeof e.href||"home"==c&&d.u.isCurrent(e.href))continue;e["class"]="string"==typeof e["class"]?d.u.concat("fon-button",e["class"]):"fon-button",a("<a></a>",e).append(b(c)).appendTo(d.buttons)}}var f=d.toggle_button.outerHeight()*d.buttons.children().length,g=parseInt(d.buttons.css("top"),0),h=parseInt(d.buttons.css("bottom"),0),i=isNaN(g)?isNaN(h)?0:h:g;d.nav.css("min-height",f+i)},menu:function(){function b(b){var c=d.o.icons[b];return c?a("<span></span>",{"class":d.u.concat("fon-item-icon",c.family,c.icon)}):a()}function c(e,f,g){var h,i,j,k,l,m=g.length;for(null!=f?(j=a("<li></li>").appendTo(e),k=a("<a></a>",{"class":"fon-item fon-item-back",href:f.href,text:f.text}).prepend(b("back")).appendTo(j),d.u.exists(f.href)&&k.addClass("fon-anchored")):"string"==typeof d.o.title&&(j=a("<li></li>").appendTo(e),k=a("<span></span>",{"class":"fon-item fon-item-title fon-anchored",text:d.o.title}).appendTo(j)),h=0;h<m;h++)l=g[h],j=a("<li></li>").appendTo(e),k=a("<a></a>",{"class":"fon-item fon-item-link",href:l.href,text:l.text}).appendTo(j),d.u.exists(l.href)&&k.addClass("fon-anchored"),a.isArray(l.children)&&(k.addClass("fon-has-menu").prepend(b("expand")),i=a("<ul></ul>",{"class":"fon-menu"}).appendTo(j),c(i,l,l.children))}d.inner=a("<div></div>",{"class":"fon-nav-inner"}).appendTo(d.nav),d.menu=a("<ul></ul>",{"class":"fon-menu"}),c(d.menu,null,d.o.items),d.inner.append(d.menu.clone())},extra:function(){null!=d.o.before&&d.nav.prepend(a("<div></div>",{"class":"fon-before"}).append(d.o.before)),null!=d.o.after&&d.nav.append(a("<div></div>",{"class":"fon-after"}).append(d.o.after))}},this.m={position:function(a){a=a||!1;var b=d.u.position();a?(d.nav.css(b.h,0),d.nav.removeClass("fon-closed fon-user-closed").addClass("fon-open")):(d.nav.css(b.h,-d.nav.outerWidth(!0)),d.nav.removeClass("fon-open").addClass("fon-closed"))},exists:function(b,c,e){if(c=c||d.menu,e=e||!1,null==b&&e)return c.find("li > .fon-item-title").first();if(b=d.u.qualify(b),e){var f=c.find("li > .fon-item-back").filter(function(){return b==d.u.qualify(a(this).attr("href"))}).first();if(f.length>0)return f}return c.find("li > .fon-item-link").filter(function(){return b==d.u.qualify(a(this).attr("href"))}).first()},active:function(a,b,c){c=c||!1,b.find("li > .fon-active").removeClass("fon-active");var e=d.m.exists(a,b,c);0!=e.length&&e.addClass("fon-active")},size:function(b){var c=a(".fon-nav-size"),e=d.nav.find(".fon-before"),f=d.nav.find(".fon-after");0==c.length&&(c=a("<div></div>",{"class":"fon-nav-size"}).appendTo("body"),a("<div></div>",{"class":"fon-nav-inner"}).appendTo(c)),c.removeClass().addClass(d.u.concat("fon-nav-size",d.o.theme,d.o.classes,d.o.position));var g=c.find(".fon-nav-inner").empty().append(b.clone());return{height:g.height(),width:g.width(),before:{height:e.height(),width:e.width()},after:{height:f.height(),width:f.width()}}},resize:function(){var a=d.inner.children(".fon-menu:first");0!=a.length&&d.m.setSize(d.m.size(a))},setSize:function(a){if("number"==typeof a.width&&"number"==typeof a.height){var b=d.u.viewportSize(),c=d.nav.height(),e=(a.before.height?a.before.height:0)+(a.after.height?a.after.height:0)+7;b.width<640&&(a.height=c-e),d.inner.css({width:a.width,height:a.height})}},get:function(a,b){return"string"==typeof a?d.m.exists(a,d.menu,b).closest(".fon-menu").clone():d.menu.clone()},set:function(a,b){b=b||!1;var c=d.m.get(a,!0);0!=c.length&&(d.inner.empty(),d.m.setSize(d.m.size(c)),d.inner.append(c),d.m.active(a,c,!0),d.m.position(b))},transition:function(a,b,c,e){e=e||f;var g,h=d.m.size(b),i={height:d.inner.height(),width:d.inner.width()},j={},k={},l={},m={},n=d.u.viewportSize(),o=d.nav.height(),p=(h.before.height?h.before.height:0)+(h.after.height?h.after.height:0)+7;n.width<640&&(h.height=o-p);var q=h.width!=i.width||h.height!=i.height?d.o.speed:0;switch(d.o.transition){case"fade":g="opacity",j[g]=k[g]=0,l[g]=1,m[g]="";break;default:g="left",j[g]=c?i.width:-i.width,k[g]=c?-i.width:i.width,l[g]=0,m[g]=""}d.inner.stop(),a.stop().animate(j,d.o.speed,function(){a.remove(),d.inner.animate(h,q,function(){d.inner.empty().append(b.css(k)),b.animate(l,d.o.speed,function(){b.css(m),e()})})})},toggle:function(a){a.allow||(a.preventDefault(),a.stopPropagation()),d.nav.toggleClass("fon-open");var b=d.nav.outerWidth(!0),c=d.nav.hasClass("fon-open"),e=d.u.position(),f=0,g=0,h={};c?f=-b:g=-b,h[e.h]=g,c?d.nav.removeClass("fon-closed fon-user-closed"):d.nav.addClass("fon-closing"),d.nav.css(e.h,f).animate(h,d.o.speed,function(){if(!c&&null!=d.nav){if(d.o.smart.enable&&!d.o.smart.remember){var a=d.menu.clone();d.inner.empty(),d.m.setSize(d.m.size(a)),d.inner.append(a),d.m.position(!1)}d.nav.removeClass("fon-closing").addClass("fon-closed fon-user-closed")}})},back:function(b){var c=a(this),e=c.attr("href"),f=d.inner.find("> .fon-menu:last"),g=d.m.get(e),h=c.hasClass("fon-anchored");d.m.transition(f,g,!0,function(){d.m.active(e,g)}),h&&d.o.smart.enable&&d.o.smart.scroll&&(b.preventDefault(),b.stopPropagation(),d.w.scroll(e),d.d.set(e.substring(1,e.length)))},clicked:function(b){var c=a(this),e=c.hasClass("fon-anchored"),f=c.hasClass("fon-has-menu"),g=c.attr("href");if(c.parents(".fon-menu:first").find("li > .fon-active").removeClass("fon-active"),c.addClass("fon-active"),f){var h=d.inner.find("> .fon-menu:last"),i=d.m.get(g,!0);d.m.transition(h,i,!1,function(){d.m.active(g,i,!0)})}e&&d.o.smart.enable&&d.o.smart.scroll?(b.preventDefault(),b.stopPropagation(),d.w.scroll(g),d.d.set(g.substring(1,g.length))):"#"==g.substring(0,1)&&d.o.smart.enable&&d.o.smart.scroll&&(b.preventDefault(),b.stopPropagation())}},this.d={set:function(a){d.o.deeplinking&&(b.history&&b.history.pushState?b.history.replaceState(null,document.title,b.location.pathname+b.location.search+"#"+a):b.location.replace((""+b.location).split("#")[0]+"#"+a))},clear:function(){d.o.deeplinking&&(b.history&&b.history.pushState?b.history.replaceState(null,document.title,b.location.pathname+b.location.search):b.location.replace((""+b.location).split("#")[0]+"#/"))}},this.a={_check:new FooNav.Timer,tracked:{elements:[],build:function(b){var c,e;for(c=0;c<b.length;c++)if(e=b[c],a.isArray(e.children)&&d.a.tracked.build(e.children),"string"==typeof e.href&&"#"==e.href.substring(0,1)){var f=a(e.href);if(0==f.length)continue;d.a.tracked.elements.push(f.addClass("fon-tracked"))}},get:function(){return d.a.tracked.elements.length>0?d.a.tracked.elements:(d.a.tracked.elements=[],d.a.tracked.build(d.o.items),d.a.tracked.elements)}},visible:function(a){var b=a.getBoundingClientRect(),c=20;return b.top>=-c&&b.left>=-c},check:function(){d.a._check.start(function(){var c=a(b).scrollTop();if(c<=d.o.scroll)d.m.set(null,d.nav.hasClass("fon-open"));else{var e,f,g,h,i=d.a.tracked.get(),j=[],k=0,l=a();for(e=0;e<i.length;e++)d.a.visible(i[e].get(0))&&j.push(i[e]);for(e=0;e<j.length;e++)f=j[e],g=f.offset(),(0==k||g.top<k)&&(k=g.top,l=f);if(0==l.length)return;h=l.attr("id"),d.m.set("#"+h,d.nav.hasClass("fon-open")||!d.nav.hasClass("fon-user-closed")&&d.o.smart.open),d.d.set(h)}},100)}},this.w={_scroll:new FooNav.Timer,_scrolled:new FooNav.Timer,_resized:new FooNav.Timer,scroll:function(c){d.a._check.stop();var e=a(c),f=e.offset().top-d.o.anchorDistance;a(b).off("scroll",d.a.check),d.w._scroll.stop(),a("html, body").stop().animate({scrollTop:f},800,function(){d.w._scroll.start(function(){d.w._to=null,a(b).on("scroll",d.a.check)},100)}),d.o.smart.enable&&d.o.smart.scroll},scrolled:function(){d.w._scrolled.start(function(){var c=a(b).scrollTop();d.o.top&&(c>0?d.top.addClass("fon-show"):d.top.removeClass("fon-show"),d.u.supportsTransitions()||(c>0?d.top.slideDown(500):d.top.slideUp(500))),0!=d.o.scroll&&(c>d.o.scroll?d.nav.fadeIn(d.o.speed):d.nav.fadeOut(d.o.speed))},100)},clicked:function(b){!d.nav.hasClass("fon-open")||d.nav.hasClass("fon-closing")||a(b.target).is("fon-nav")||0!=a(b.target).closest(".fon-nav").length||(b.allow=!0,d.m.toggle.call(d.toggle_button.get(0),b))},top:function(b){b.preventDefault(),b.stopPropagation(),d.o.smart.enable&&d.o.smart.scroll?a("html, body").stop().animate({scrollTop:0},1e3):a("html, body").scrollTop(0)},resized:function(){d.w._resized.start(function(){d.m.resize()},100)}},this.init(c)}}(jQuery,window);